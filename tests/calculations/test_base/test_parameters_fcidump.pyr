#!/usr/bin/env python
"""Script automatically generated by `pyscf.base` plugin of `aiida-pyscf`."""


def main():
    import json
    import time

    results = {
        'timings': {}
    }

    time_start = time.perf_counter()


    # Section: Structure definition
    from pyscf import gto
    structure = gto.Mole()
    structure.unit = 'Ang'
    structure.atom = """
    O       0.000000000000000      0.000000000000000      0.119262000000000
    H       0.000000000000000      0.763239000000000     -0.477047000000000
    H       0.000000000000000     -0.763239000000000     -0.477047000000000
    """
    structure.build()

    # Section: Mean field
    from pyscf import scf
    mean_field = scf.RHF(structure)
    mean_field_start = time.perf_counter()
    mean_field_run = mean_field.run()

    results['timings']['mean_field'] = time.perf_counter() - mean_field_start
    results['total_energy'] = mean_field_run.e_tot
    results['forces'] = (- mean_field_run.nuc_grad_method().kernel()).tolist()



    # Section: fcidump
    from pyscf.mcscf.casci import CASCI
    from pyscf.tools import fcidump

    for active_spaces, occupations in zip([[5, 6], [5, 7]], [[1, 1], [1, 1]]):
        casci = CASCI(mean_field_run, len(active_spaces), sum(occupations))
        new_mo = casci.sort_mo(active_spaces)
        one_integral, shift = casci.h1e_for_cas(new_mo)
        two_integral = casci.get_h2eff(new_mo)
        fcidump.from_integrals(
            f"active_space_{'_'.join([str(index) for index in active_spaces])}.fcidump",
            one_integral,
            two_integral,
            casci.ncas,
            casci.nelecas,
            nuc=shift
        )

    # Section: Results
    results['timings']['total'] = time.perf_counter() - time_start

    with open('results.json', 'w') as handle:
        json.dump(results, handle)


if __name__ == '__main__':
    main()
